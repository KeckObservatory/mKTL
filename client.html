

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Client interface &mdash; mKTL 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=4bba6b87" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=2709fde1"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Daemon interface" href="daemon.html" />
    <link rel="prev" title="Introduction" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            mKTL
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Client interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mktl.home"><code class="docutils literal notranslate"><span class="pre">home()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#mktl.get"><code class="docutils literal notranslate"><span class="pre">get()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-store-class">The Store class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mktl.Store"><code class="docutils literal notranslate"><span class="pre">Store</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-item-class">The Item class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mktl.Item"><code class="docutils literal notranslate"><span class="pre">Item</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mktl.Item.get"><code class="docutils literal notranslate"><span class="pre">Item.get()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mktl.Item.register"><code class="docutils literal notranslate"><span class="pre">Item.register()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mktl.Item.set"><code class="docutils literal notranslate"><span class="pre">Item.set()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mktl.Item.subscribe"><code class="docutils literal notranslate"><span class="pre">Item.subscribe()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mktl.Item.value"><code class="docutils literal notranslate"><span class="pre">Item.value</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="daemon.html">Daemon interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="executables.html">Executables</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocol.html">Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocol_interface.html">Protocol interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mKTL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Client interface</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/client.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="client-interface">
<span id="client"></span><h1>Client interface<a class="headerlink" href="#client-interface" title="Link to this heading"></a></h1>
<p>A client is any software component interacting with a daemon, in the form of
issuing requests, receiving responses to requests, and receiving asynchronous
updates of new item values. The Python interface described here makes liberal
use of background threads, callbacks in particular can and will arrive from
background threads as asynchronous updates arrive.</p>
<p>Unlike the <a class="reference internal" href="daemon.html#daemon"><span class="std std-ref">Daemon interface</span></a>, a typical client application will not need subclasses
of the classes defined here, they are expected to be used directly, as-is.</p>
<section id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Link to this heading"></a></h2>
<p>mKTL will cache information locally; there are no restrictions on where this
information gets cached, other than it needs to be cached somewhere. The
default location for this cache is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$HOME/.mKTL
</pre></div>
</div>
<p>You can override this location by setting the <code class="docutils literal notranslate"><span class="pre">MKTL_HOME</span></code> environment
variable to the absolute path of your choice; any directory specified in
this fashion will be created if it does not already exist. Alternatively,
the program may invoke the <a class="reference internal" href="#mktl.home" title="mktl.home"><code class="xref py py-func docutils literal notranslate"><span class="pre">mktl.home()</span></code></a> method to specify the location
at run time.</p>
<dl class="py function">
<dt class="sig sig-object py" id="mktl.home">
<span class="sig-prename descclassname"><span class="pre">mktl.</span></span><span class="sig-name descname"><span class="pre">home</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mktl.home" title="Link to this definition"></a></dt>
<dd><p>Return the directory location where we should be loading and/or saving
configuration files. This defaults to <code class="docutils literal notranslate"><span class="pre">$HOME/.mKTL</span></code>, but can be
overridden by calling this method with a valid path, or by setting
the <code class="docutils literal notranslate"><span class="pre">MKTL_HOME</span></code> environment variable. Note that changes to the
environment variable will be ignored unless it is set prior to the
first invocation of this method.</p>
</dd></dl>

<p>The <a class="reference internal" href="#mktl.get" title="mktl.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">mktl.get()</span></code></a> method is the universal entry point to retrieve a
<a class="reference internal" href="#mktl.Store" title="mktl.Store"><code class="xref py py-class docutils literal notranslate"><span class="pre">mktl.Store</span></code></a> or <a class="reference internal" href="daemon.html#mktl.Item" title="mktl.Item"><code class="xref py py-class docutils literal notranslate"><span class="pre">mktl.Item</span></code></a> instance; client configuration is
automatically refreshed if necessary, and the remainder of the connection logic
is handled by the <a class="reference internal" href="#mktl.Store" title="mktl.Store"><code class="xref py py-class docutils literal notranslate"><span class="pre">mktl.Store</span></code></a>.</p>
<p>All other client operations, such as getting and setting item values, are
handled via the <a class="reference internal" href="daemon.html#mktl.Item" title="mktl.Item"><code class="xref py py-class docutils literal notranslate"><span class="pre">mktl.Item</span></code></a> instance.</p>
<dl class="py function">
<dt class="sig sig-object py" id="mktl.get">
<span class="sig-prename descclassname"><span class="pre">mktl.</span></span><span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">store</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mktl.get" title="Link to this definition"></a></dt>
<dd><p>The <a class="reference internal" href="#mktl.get" title="mktl.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">get()</span></code></a> method is intended to be the primary entry point for
all interactions with a key/value store.</p>
<p>The return value is either a cached <a class="reference internal" href="#mktl.Store" title="mktl.Store"><code class="xref py py-class docutils literal notranslate"><span class="pre">Store</span></code></a> or <a class="reference internal" href="daemon.html#mktl.Item" title="mktl.Item"><code class="xref py py-class docutils literal notranslate"><span class="pre">Item</span></code></a>
instance. If both a <em>store</em> and a <em>key</em> are specified, the requested
item will be returned from the specified <em>store</em>. The same will occur
if the sole argument is a store and key name concatenated with a dot
(store.KEY). A <a class="reference internal" href="#mktl.Store" title="mktl.Store"><code class="xref py py-class docutils literal notranslate"><span class="pre">Store</span></code></a> instance will be returned if the sole
argument provided is a <em>store</em> name. Both the <em>store</em> and the <em>key</em>
are case-insensitive.</p>
<p>If the caller always uses <a class="reference internal" href="#mktl.get" title="mktl.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">get()</span></code></a> to retrieve a <a class="reference internal" href="#mktl.Store" title="mktl.Store"><code class="xref py py-class docutils literal notranslate"><span class="pre">Store</span></code></a> or
<a class="reference internal" href="daemon.html#mktl.Item" title="mktl.Item"><code class="xref py py-class docutils literal notranslate"><span class="pre">Item</span></code></a> they will always receive the same instance of that class.
In that sense, <a class="reference internal" href="#mktl.get" title="mktl.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">get()</span></code></a> is a factory method enforcing a singleton
pattern.</p>
</dd></dl>

</section>
<section id="the-store-class">
<h2>The Store class<a class="headerlink" href="#the-store-class" title="Link to this heading"></a></h2>
<p>The <a class="reference internal" href="#mktl.Store" title="mktl.Store"><code class="xref py py-class docutils literal notranslate"><span class="pre">mktl.Store</span></code></a> class is primarily an organizational structure,
providing a dictionary-like interface to retrieve <a class="reference internal" href="daemon.html#mktl.Item" title="mktl.Item"><code class="xref py py-class docutils literal notranslate"><span class="pre">mktl.Item</span></code></a> instances.</p>
<dl class="py class">
<dt class="sig sig-object py" id="mktl.Store">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mktl.</span></span><span class="sig-name descname"><span class="pre">Store</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mktl.Store" title="Link to this definition"></a></dt>
<dd><p>The <a class="reference internal" href="#mktl.Store" title="mktl.Store"><code class="xref py py-class docutils literal notranslate"><span class="pre">Store</span></code></a> implements a key/value store, effectively a Python
dictionary with some additional context. A store has a unique <em>name</em>
within the local mKTL context; which daemons will be contacted to handle
further requests is determined on a per-Item basis, re-use of
connections is managed in the <a class="reference internal" href="protocol_interface.html#module-mktl.protocol" title="mktl.protocol"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mktl.protocol</span></code></a> submodule, not here.</p>
</dd></dl>

</section>
<section id="the-item-class">
<h2>The Item class<a class="headerlink" href="#the-item-class" title="Link to this heading"></a></h2>
<p>The bulk of the client interactions will occur with the <a class="reference internal" href="daemon.html#mktl.Item" title="mktl.Item"><code class="xref py py-class docutils literal notranslate"><span class="pre">mktl.Item</span></code></a>
class. In addition to the methods described here an <a class="reference internal" href="daemon.html#mktl.Item" title="mktl.Item"><code class="xref py py-class docutils literal notranslate"><span class="pre">mktl.Item</span></code></a> instance
can be used with Python operators, such as addition/concatenation or
multiplication.
The behavior of an <a class="reference internal" href="daemon.html#mktl.Item" title="mktl.Item"><code class="xref py py-class docutils literal notranslate"><span class="pre">mktl.Item</span></code></a> when used in this fashion will be aligned
with the native Python binary type for the item value; for example, if an
item test.BAR has an integer value 12, <code class="docutils literal notranslate"><span class="pre">test.BAR</span> <span class="pre">+</span> <span class="pre">5</span></code> will return the integer
value 17. If test.BAR is instead the string value ‘12’, the same operation
would raise a TypeError exception; however, <code class="docutils literal notranslate"><span class="pre">test.BAR</span> <span class="pre">+</span> <span class="pre">'5'</span></code> would return
the string value ‘125’, just like you would expect for string concatenation.</p>
<dl class="py class">
<dt class="sig sig-object py" id="mktl.Item">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mktl.</span></span><span class="sig-name descname"><span class="pre">Item</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">store</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subscribe</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">authoritative</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pub</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mktl.Item" title="Link to this definition"></a></dt>
<dd><p>An Item represents a key/value pair, where the key is the name of the
Item, and the value is whatever is provided by the authoritative daemon.
The principal way for both clients and daemons to get or set the value
is via the <a class="reference internal" href="#mktl.Item.value" title="mktl.Item.value"><code class="xref py py-func docutils literal notranslate"><span class="pre">value()</span></code></a> property.</p>
<p>A non-authoritative Item will automatically <a class="reference internal" href="#mktl.Item.subscribe" title="mktl.Item.subscribe"><code class="xref py py-func docutils literal notranslate"><span class="pre">subscribe()</span></code></a> itself to
any available updates.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mktl.Item.get">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">refresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">formatted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mktl.Item.get" title="Link to this definition"></a></dt>
<dd><p>Retrieve the current value. Set <em>refresh</em> to True to prompt
the daemon handling the request to provide the most up-to-date
value available, potentially bypassing any local cache. Set
<em>formatted</em> to True to receive the human-readable formatting
of the value, if any such formatting is available.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mktl.Item.register">
<span class="sig-name descname"><span class="pre">register</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">method</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mktl.Item.register" title="Link to this definition"></a></dt>
<dd><p>Register a callback to be invoked whenever a new value is received
from a remote daemon, regardless of how that new value arrived.
<a class="reference internal" href="#mktl.Item.subscribe" title="mktl.Item.subscribe"><code class="xref py py-func docutils literal notranslate"><span class="pre">subscribe()</span></code></a> will automatically be invoked if it has not been
invoked for this <a class="reference internal" href="daemon.html#mktl.Item" title="mktl.Item"><code class="xref py py-class docutils literal notranslate"><span class="pre">Item</span></code></a> instance, the client does not need
to call it separately.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mktl.Item.set">
<span class="sig-name descname"><span class="pre">set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mktl.Item.set" title="Link to this definition"></a></dt>
<dd><p>Set a new value. Set <em>wait</em> to True to block until the request
completes; this is the default behavior. If <em>wait</em> is set to False,
the caller will be returned a <a class="reference internal" href="protocol_interface.html#mktl.protocol.message.Request" title="mktl.protocol.message.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">mktl.protocol.message.Request</span></code></a>
instance, which has a <a class="reference internal" href="protocol_interface.html#mktl.protocol.message.Request.wait" title="mktl.protocol.message.Request.wait"><code class="xref py py-func docutils literal notranslate"><span class="pre">mktl.protocol.message.Request.wait()</span></code></a>
method that can optionally be invoked to block until completion of
the request; the wait will return immediately once the request is
satisfied. There is no return value for a blocking request; failed
requests will raise exceptions.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mktl.Item.subscribe">
<span class="sig-name descname"><span class="pre">subscribe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prime</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mktl.Item.subscribe" title="Link to this definition"></a></dt>
<dd><p>Subscribe to all future broadcast events. Doing so ensures that
locally cached values will always be current, regardless of any
local polling behavior. If <em>prime</em> is True a call
will be made to <a class="reference internal" href="#mktl.get" title="mktl.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">get()</span></code></a> to refresh the locally cached value
before this method returns.</p>
<p>A non-authoritative <a class="reference internal" href="daemon.html#mktl.Item" title="mktl.Item"><code class="xref py py-class docutils literal notranslate"><span class="pre">Item</span></code></a> will automatically call
<a class="reference internal" href="#mktl.Item.subscribe" title="mktl.Item.subscribe"><code class="xref py py-func docutils literal notranslate"><span class="pre">subscribe()</span></code></a> upon being instantiated.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mktl.Item.value">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">value</span></span><a class="headerlink" href="#mktl.Item.value" title="Link to this definition"></a></dt>
<dd><p>Get and set the current value of the item. Invoke <a class="reference internal" href="#mktl.get" title="mktl.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">get()</span></code></a> and
<a class="reference internal" href="#mktl.Item.set" title="mktl.Item.set"><code class="xref py py-func docutils literal notranslate"><span class="pre">set()</span></code></a> directly for additional control over how these
respective calls are handled, the handling invoked here relies on
default values for all optional arguments.</p>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="daemon.html" class="btn btn-neutral float-right" title="Daemon interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright W. M. Keck Observatory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>